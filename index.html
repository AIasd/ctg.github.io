<!Doctype html>
<html lang="en">
    <head>
        <title>CTG</title>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="author" content="Davis Rempe">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" type="text/css" href="style_project_page.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
        <link href="https://fonts.googleapis.com/css?family=Arvo|Roboto&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css">
        <link rel="stylesheet" href="https://unpkg.com/@glidejs/glide/dist/css/glide.core.min.css">
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="https://unpkg.com/@glidejs/glide"></script>
        <style type="text/css">
            .side-text {
                width:60%;
                display:inline-block;
                vertical-align:top;
            }
            .side-image {
                width: 38%;
                display: inline-block;
                vertical-align: top;
            }
            .controls {
                margin-bottom: 10px;
            }
            .left-controls {
                display: inline-block;
                vertical-align: top;
                width: 80%;
            }
            .right-controls {
                display: inline-block;
                vertical-align: top;
                width: 19%;
                text-align: right;
            }
            .render_window {
                display: inline-block;
                vertical-align: middle;
                box-shadow: 1px 0px 5px black;
                margin-right: 10px;
                margin-bottom: 10px;
                width: calc(33% - 10px);
            }
            .progress {
                background: #666;
                position: relative;
                height: 5px;
                margin-bottom: -5px;
                display: none;
            }
            .glide__slide:hover {cursor: grab;}
            .glide__slide:active {cursor: grabbing;}
            .glide__slide img {width: 90%;}
            .glide__bullets {
                text-align: center;
            }
            .glide__bullet--active {
                color: #aaa; 
            }

            @media (max-width: 400px) {
                .render_window {
                    display: block;
                    width: 90%;
                    margin: 10px auto;
                }
            }
            @media (max-width: 700px) {
                .side-image {
                    display: block;
                    width: 80%;
                    margin: 10px auto;
                }
                .side-text {
                    display: block;
                    width: 100%;
                }
            }
        </style>
    </head>
    <body>
        <div class="section">
            <h1 class="project-title">
                Guided Conditional Diffusion for Controllable Traffic Simulation
            </h1>
            <div class="authors">
                <a href=https://aiasd.github.io>
                    Ziyuan Zhong<sup>1,2</sup>
                </a>
                <a href=https://davrempe.github.io>
                    Davis Rempe<sup>1,3</sup>
                </a>
                <a href=https://faculty.cc.gatech.edu/~danfei>
                    Danfei Xu<sup>1,4</sup>
                </a>
                <a href=https://research.nvidia.com/person/yuxiao-chen>
                    Yuxiao Chen<sup>1</sup>
                </a>
                <br>
                <a href=https://research.nvidia.com/person/sushant-veer>
                    Sushant Veer<sup>1</sup>
                </a>
                <a href=https://nvr-avg.github.io/author/gerry-che>
                    Tong Che<sup>1</sup>
                </a>
                <a href=https://www.rayb.info>
                    Baishakhi Ray<sup>2</sup>
                </a>
                <a href=https://research.nvidia.com/person/marco-pavone>
                    Marco Pavone<sup>1,3</sup>
                </a>
            </div>

            <div class="affiliations">
                <span><sup>1</sup> NVIDIA</span>&emsp;
                <span><sup>2</sup> Columbia University</span>&emsp;
                <span><sup>3</sup> Stanford University</span>&emsp;
                <span><sup>4</sup> Georgia Tech</span>
            </div>
            
            <div class="project-icons">
                <a href="https://arxiv.org/pdf/2210.17366.pdf">
                    <i class="fa fa-file"></i> <br/>
                    Paper
                </a>
            </div>

            <div class="section-title"></div>
            <div class="teaser-image">
                <center>
                <img src="img/ctg_overview_v2.png" style="width:80%;">
                </center>
            <div class="content">
                <p>
                    Controllable and realistic traffic simulation is critical for developing and verifying autonomous vehicles. Typical heuristic-based traffic models offer flexible control to make vehicles follow specific trajectories and traffic rules. On the other hand, data-driven approaches generate realistic and human-like behaviors, improving transfer from simulated to real-world traffic. However, to the best of our knowledge, no traffic model offers both controllability and realism. In this work, we develop a conditional diffusion model for <b>controllable traffic generation (CTG) that allows users to control desired properties of trajectories at test time (e.g., reach a goal or follow a speed limit) while maintaining realism and physical feasibility through enforced dynamics.</b> The key technical idea is to leverage recent advances from <b>diffusion modeling and differentiable logic to guide generated trajectories to meet rules defined using signal temporal logic (STL).</b> We further <b>extend guidance to multi-agent settings and enable interaction-based rules</b> like collision avoidance. CTG is extensively evaluated on the nuScenes dataset for diverse and composite rules, demonstrating improvement over strong baselines in terms of the controllability-realism tradeoff.
                    <br><br>
                    We present demos for five single-rule settings and two multi-rules settings in the following sections. For each setting, we compare CTG with the two strongest baselines in terms of rule violations for that setting (based on the quantitative results in the main paper). Note that all the videos are played at 5x speed.
                </p>
            </div>


            <div class="section-title">Speed Limit</div>
            <div class="content">
                <p>
                    In this scene, the vehicles are supposed to drive under the specified speed limit. BC+opt generates trajectories with a vehicle (red vehicle) driving off-road. Compared with BC+opt and BITS+opt, CTG has the lowest speed limit violation (0.101m/s), and smoother and realistic trajectories.
                    </br></br>

                    <table align=center width=900px>
                        <tr>
                            <center>
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/speed_limit/speed_limit1/BC_opt_0.224/scene-0094.mp4" type="video/mp4">
                                    </video>
                                </td>                
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/speed_limit/speed_limit1/BITS_opt_0.138/scene-0094.mp4" type="video/mp4">
                                    </video>
                                </td> 
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/speed_limit/speed_limit1/CTG_0.101/scene-0094.mp4" type="video/mp4">
                                    </video>
                                </td>                 
                            </center>
                        </tr>          
                        <tr>
                            <center>
                                <td colspan='2'>
                                    <center>
                                        <b>BC+opt</b> (speed limit violation: 0.224m/s)
                                    </center>
                                </td>
                                <td colspan='2'>
                                    <center>
                                        <b>BITS+opt</b> (speed limit violation: 0.138m/s)                       
                                    </center>
                                </td>
                                <td colspan='2'>
                                    <center>
                                        <b>CTG</b> (speed limit violation: 0.101m/s)
                                    </center>
                                </td>
                            </center>
                        </tr>
                        
                    </table>
                </p>
            </div>

            <div class="section-title">Target Speed</div>
            <div class="content">
                <p>
                    In this scene, the vehicles are supposed to drive following the corrsponding speed at each time step. Both TrafficSim+opt and BC+opt generate trajectories with vehicles (blue vehicle) going off-road. Compared with TrafficSim+opt and BC+opt, CTG has the lowest target speed violation (0.3m/s) and more realistic trajectories.
                    </br></br>

                    <table align=center width=900px>
                        <tr>
                            <center>
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/target_speed_0.5/BC_opt_1.26/scene-0273.mp4" type="video/mp4">
                                    </video>
                                </td>                
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/target_speed_0.5/TrafficSim_opt_1.11/scene-0273.mp4" type="video/mp4">
                                    </video>
                                </td> 
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/target_speed_0.5/CTG_0.28/scene-0273.mp4" type="video/mp4">
                                    </video>
                                </td>                 
                            </center>
                        </tr>          
                        <tr>
                            <center>
                                <td colspan='2'>
                                    <center>
                                        <b>BC+opt</b> (target speed violation: 1.3m/s)
                                    </center>
                                </td>
                                <td colspan='2'>
                                    <center>
                                        <b>TrafficSim+opt</b> (target speed violation: 1.1m/s)                       
                                    </center>
                                </td>
                                <td colspan='2'>
                                    <center>
                                        <b>CTG</b> (target speed violation: 0.3m/s)
                                    </center>
                                </td>
                            </center>
                        </tr>
                        
                    </table>
                </p>
            </div>

            <div class="section-title">Goal Waypoint</div>
            <div class="content">
                <p>
                    In this scene, the vehicles are supposed to reach the specified goal waypoints (plotted as circles on the map). Although BC+opt has lower goal waypoint violation (2.2m) than CTG (3.2m), both BC+opt and BITS+opt generate curvy, unrealistic trajectories and result in multiple collisions (e.g, purple vehicle and green vehicle). In contrast, CTG generates smooth and realistic trajectories with no collisions.
                    </br></br>

                    <table align=center width=900px>
                        <tr>
                            <center>
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/goal_waypoint_100/BC_opt_2.15/scene-0555.mp4" type="video/mp4">
                                    </video>
                                </td>                
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/goal_waypoint_100/BITS_opt_6.28/scene-0555.mp4" type="video/mp4">
                                    </video>
                                </td> 
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/goal_waypoint_100/CTG_3.17/scene-0555.mp4" type="video/mp4">
                                    </video>
                                </td>                 
                            </center>
                        </tr>          
                        <tr>
                            <center>
                                <td colspan='2'>
                                    <center>
                                        <b>BC+opt</b> (goal waypoint violation: 2.2m)
                                    </center>
                                </td>
                                <td colspan='2'>
                                    <center>
                                        <b>BITS+opt</b> (goal waypoint violation: 6.3m)                      
                                    </center>
                                </td>
                                <td colspan='2'>
                                    <center>
                                        <b>CTG</b> (goal waypoint violation: 3.2m)
                                    </center>
                                </td>
                            </center>
                        </tr>
                        
                    </table>
                </p>
            </div>

            <div class="section-title">No Off-road</div>
            <div class="content">
                <p>
                    In this scene, the vehicles are supposed to avoid going off-road. Although all the three methods generate trajectories without going off-road, CTG generates more realistic trajectories that are more likely to be observed in real-world traffic. In particular, BC+opt generates trajectories leading to multiple collisions (e.g., red vehicle and purple vehicle). TrafficSim+opt generates trajectories less smooth with one vehicle (blue vehicle) goes to a lane with wrong direction. In contrast, CTG produce smooth trajectories with vehicles all going along correct lanes and having no collisions.
                    </br></br>

                    <table align=center width=900px>
                        <tr>
                            <center>
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/offroad/offroad1/BC_opt/scene-0096.mp4" type="video/mp4">
                                    </video>
                                </td>                
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/offroad/offroad1/TrafficSim_opt/scene-0096.mp4" type="video/mp4">
                                    </video>
                                </td> 
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/offroad/offroad1/CTG/scene-0096.mp4" type="video/mp4">
                                    </video>
                                </td>                 
                            </center>
                        </tr>          
                        <tr>
                            <center>
                                <td colspan='2'>
                                    <center>
                                        <b>BC+opt</b> (Off-road violation: 0)
                                    </center>
                                </td>
                                <td colspan='2'>
                                    <center>
                                        <b>TrafficSim+opt</b> (Off-road violation: 0)                      
                                    </center>
                                </td>
                                <td colspan='2'>
                                    <center>
                                        <b>CTG</b> (Off-road violation: 0)
                                    </center>
                                </td>
                            </center>
                        </tr>
                        
                    </table>
                </p>
            </div>

            <div class="section-title">No Collision</div>
            <div class="content">
                <p>
                    In this scene, the vehicles are supposed to avoid collisions with each other. BITS generates trajectories leading to multiple vehicles collide with each other at the end (e.g., green vehicle and orange vehicle). Both CTG and BITS+opt do not have collisions. However, BITS+opt generates more curvy, less realistic trajectories (e.g., see the blue vehicle). In contrast, CTG generates smoother, more realistic trajectories.
                    </br></br>

                    <table align=center width=900px>
                        <tr>
                            <center>
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/agent_collision/agent_collision1/BITS_0.238/scene-0093.mp4" type="video/mp4">
                                    </video>
                                </td>                
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/agent_collision/agent_collision1/BITS_opt_0/scene-0093.mp4" type="video/mp4">
                                    </video>
                                </td> 
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/agent_collision/agent_collision1/CTG_0/scene-0093.mp4" type="video/mp4">
                                    </video>
                                </td>                 
                            </center>
                        </tr>          
                        <tr>
                            <center>
                                <td colspan='2'>
                                    <center>
                                        <b>BITS</b> (Collision Violation: 0.238)
                                    </center>
                                </td>
                                <td colspan='2'>
                                    <center>
                                        <b>BITS+opt</b> (Collision Violation: 0)                     
                                    </center>
                                </td>
                                <td colspan='2'>
                                    <center>
                                        <b>CTG</b> (Collision Violation: 0)
                                    </center>
                                </td>
                            </center>
                        </tr>
                        
                    </table>
                </p>
            </div>

            <div class="section-title">StopSign + No Off-road</div>
            <div class="content">
                <p>
                    In this scene, the vehicles are supposed to stop if they enter the corresponding stop sign regions (denoted as colored square regions) and not go off-road. TrafficSim generates trajectories with vehicles keep driving within the corrsponding stop sign regions and going off road (blue vehicle), and leading to multiple collisions (e.g., green vehicle and orange vehicle). TrafficSim+opt generates trajectories with some vehicles not stopping within the stop regions (purple vehicle) and a collision between two vehicles (orange vehicle and yellow vehicle). In contrast, CTG produce trajectories without going off-road and all vehicles stop within the stop sign regions. CTG has acehieved much lower average minimum speed within the stop regions (0.001m/s VS 2.349m/s and 0.105m/s)
                    </br></br>

                    <table align=center width=900px>
                        <tr>
                            <center>
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/stopsign_offroad/stopsign_offroad1/TrafficSim_2.349_0.2621/scene-0275.mp4" type="video/mp4">
                                    </video>
                                </td>                
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/stopsign_offroad/stopsign_offroad1/TrafficSim_opt_0.1051_0.1736/scene-0275.mp4" type="video/mp4">
                                    </video>
                                </td> 
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/stopsign_offroad/stopsign_offroad1/CTG_0.0006_0.1429/scene-0275.mp4" type="video/mp4">
                                    </video>
                                </td>                 
                            </center>
                        </tr>          
                        <tr>
                            <center>
                                <td colspan='2'>
                                    <center>
                                        <b>TrafficSim</b> (stop sign violation: 2.349m/s, Off-road violation: 0.143)
                                    </center>
                                </td>
                                <td colspan='2'>
                                    <center>
                                        <b>TrafficSim+opt</b> (stop sign violation: 0.105m/s, Off-road violation: 0)                  
                                    </center>
                                </td>
                                <td colspan='2'>
                                    <center>
                                        <b>CTG</b> (stop sign violation: 0.001m/s, Off-road violation: 0)
                                    </center>
                                </td>
                            </center>
                        </tr>
                        
                    </table>
                </p>
            </div>

            <div class="section-title">Goal Waypoint + Target Speed</div>
            <div class="content">
                <p>
                    In this scene, the vehicles are supposed to reach goal waypoints (colored circles) with specified target speed.TrafficSim generates trajectories with one vehicle not reaching goal waypoint (gray vehicle). For BITS, while vehicles reach waypoints, the gray vehicle collides with the pink vehicle. In contrast, CTG produce trajectories reaching waypoints without collisions. Furthermore, CTG generated trajectories best satisfy the goal waypoint (with smallest goal waypoint violation 0.315m) and target speed (with smallest target speed violation 0.161m/s).
                    </br></br>

                    <table align=center width=900px>
                        <tr>
                            <center>
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/goal_waypoint_100_target_speed/goal_waypoint_100_target_speed1/TrafficSim_1.015_0.312/scene-0108.mp4" type="video/mp4">
                                    </video>
                                </td>                
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/goal_waypoint_100_target_speed/goal_waypoint_100_target_speed1/BITS_0.391_0.285/scene-0108.mp4" type="video/mp4">
                                    </video>
                                </td> 
                                <td colspan='2'>
                                    <video width="300" height="300" controls muted autoplay loop>
                                        <source src="./videos/goal_waypoint_100_target_speed/goal_waypoint_100_target_speed1/CTG_0.315_0.161/scene-0108.mp4" type="video/mp4">
                                    </video>
                                </td>                 
                            </center>
                        </tr>          
                        <tr>
                            <center>
                                <td colspan='2'>
                                    <center>
                                        <b>TrafficSim</b> (goal waypoint violation: 1.015m, target speed violation: 0.312m/s)
                                    </center>
                                </td>
                                <td colspan='2'>
                                    <center>
                                        <b>BITS</b> (goal waypoint violation: 0.391m, target speed violation: 0.285m/s)                
                                    </center>
                                </td>
                                <td colspan='2'>
                                    <center>
                                        <b>CTG</b> (goal waypoint violation: 0.315m, target speed violation: 0.161m/s)
                                    </center>
                                </td>
                            </center>
                        </tr>
                        
                    </table>
                </p>
            </div>

            <!-- <div class="section-title">Citation</div>
            <div class="section bibtex">
            <pre>
                     
            </pre>
            </div>
            <br> -->

            <div class="section-title">Acknowledgments</div>
            <div class="content">
                This project page template is based on <a href="https://github.com/paschalidoud/paschalidoud.github.io/blob/master/neural_parts.html">this page</a>.
            </div>
            
            <div class="section-title">Contact</div>
            <div class="content">
                For any questions, please contact Ziyuan Zhong at <a href="mailto:ziyuan.zhong@columbia.edu">ziyuan.zhong@columbia.edu</a>.
            </div>
        </div>        
    
    </body>
</html>
